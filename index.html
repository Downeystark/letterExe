<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title></title>
<link href="index.css" rel="stylesheet">
</head>
<body>

<textarea id="source" rows="20" cols="100">
<h1>dfdfd</h1>
<div>sadfasdf</div>
<h2>dfdfd</h2>
<p>dfasdf</p>
<img src="x" alt="">
<a href="">test</a>
<div>sadfasdf</div>
<img src="x" alt="">
</textarea>

<textarea id="compiled" rows="20" cols="100"></textarea>

<script type="text/javascript" src="jquery.min.js"></script>
<script type="text/javascript">
	$(function(){
		
		String.prototype.getQuery = function(Startname,endName){ 
			var reg = new RegExp('(^|\\<)'+Startname+' ([^<]*|\/>$)');
			var url = this.toString();
			var r = url.match(reg);
			return r === null ? null : unescape(r[0].replace(Startname,endName).replace('/>','></'+endName+'>')); 
		}
		var str = 'http://wpa.qq.com/msgrd?v=3&uin=1438344583&site=q q&menu=yes<img src="adsfsda" />'; 
		
		$('#source').keyup(function(){
			var s = $(this).val();
			$('#compiled').val(compoled.exe(s));
		})
		
		var compoled = {
			exe : function(data){
				var regexpStart = /<div|<h[1|2|3|4]|<p|<a|<span|<header|href=|<img ([^<]*|\/>$)/g;
				var regexpEnd = /<\/div|<\/h[1|2|3|4]|<\/p|<\/a|<\/span|<\/header/g;
				data = data.replace(regexpStart,function(str){
					var repStart = '<view';
					console.log(str);
					switch(str){
						case 'href=':
							repStart = 'bindtap=';
						break;
					}
					return repStart;
				});
				
				data = data.replace(regexpEnd,function(str){
					var repEnd = '</view';
					console.log(str);
					switch(str){
						case 'href=':
							repEnd = 'bindtap=';
						break;
					}
					return repEnd;
				});
				//data = data.getQuery('img','image'); 
				return data;
			},
			
			
		}
		
		$('#source').keyup();
		
	})
</script>
</body>
</html>